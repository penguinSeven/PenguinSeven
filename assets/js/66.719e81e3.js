(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{413:function(a,e,t){"use strict";t.r(e);var s=t(25),_=Object(s.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"mysql-数据库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#mysql-数据库"}},[a._v("#")]),a._v(" Mysql 数据库")]),a._v(" "),e("h2",{attrs:{id:"常见问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#常见问题"}},[a._v("#")]),a._v(" 常见问题")]),a._v(" "),e("h3",{attrs:{id:"_1-修改权限"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-修改权限"}},[a._v("#")]),a._v(" 1. 修改权限")]),a._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("-- 赋予任何主机访问数据的权限\nGRANT ALL RIVILEGES ON *.* TO 'root'@'%' WITH GRANT OPTION              \n")])])]),e("h3",{attrs:{id:"_2-结束符定义"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-结束符定义"}},[a._v("#")]),a._v(" 2. 结束符定义")]),a._v(" "),e("ul",[e("li",[e("p",[a._v("总所周知，mysql的命令行执行每一条命令是以分号结尾的，也就是说识别是否为一条命令，是根据分号决定的。\n然而存储过程中设计多条语句，很可能出现多个分号，所以直接把存储过程复制到命令号一般都会失败")])]),a._v(" "),e("li",[e("p",[a._v("解决方法是需要加一个分隔符，让命令行知道整个存储过程的代码是完整的一块代码,代码如下")])])]),a._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("DELIMITER //     \nCREATE PROCEDURE p_name (IN b INTEGER(12))     \nbegin     \n declare a INTEGER(12);     \n set a=12;     \n INSERT INTO t VALUES (a);     \n SELECT s1* a FROM t;     \nEnd     \n//    \n\n")])])]),e("ul",[e("li",[e("p",[a._v("如代码中所示，在存储过程的开头加上“DELIMITER //”,结尾加上“//”就ok了")])]),a._v(" "),e("li",[e("p",[a._v("执行后续的sql ，需将结束符重新定义")])])]),a._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("DELIMITER ;\n")])])]),e("h3",{attrs:{id:"_3-order-by-自定义规则"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-order-by-自定义规则"}},[a._v("#")]),a._v(" 3. ORDER BY 自定义规则")]),a._v(" "),e("blockquote",[e("p",[a._v("问题描述:"),e("br"),a._v("\n大家都知道, MySQL 中按某字段升序排列的 SQL 为 (以 id 为例, 下同):")])]),a._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("\nSELECT * FROM `MyTable` \nWHERE `id` IN (1, 7, 3, 5) \nORDER BY `id` ASC\n\n")])])]),e("p",[a._v("降序排列的 SQL 为:")]),a._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("SELECT * FROM `MyTable` \nWHERE `id` IN (1, 7, 3, 5) \nORDER BY `id` DESC\n")])])]),e("p",[a._v("有时以上排序并不能满足我们的需求. 例如, 我们想要按 id 以 5, 3, 7, 1 的顺序排列, 该如何实现. 这也是很多国内外同行经常遇到的问题之一.")]),a._v(" "),e("p",[a._v('下面我们给出按表中某字段, 以我们想要的列表方式排序的解决方案.\n解决方案用"按字段排序" (ORDER BY FIELD).语法:')]),a._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("  SELECT * FROM MyTable \n  ORDER BY FIELD(`id`, 5, 3, 7, 1)\n")])])]),e("p",[a._v("要注意的是, FIELD 后面是没有空格的.\n因此, 完整的 SQL 为:")]),a._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("SELECT * FROM `MyTable` \nWHERE `id` IN (1, 7, 3, 5) \nORDER BY FIELD(`id`, 5, 3, 7, 1)\n")])])]),e("p",[a._v("常见应用:")]),a._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("SELECT * FROM `MyTable` \nWHERE `name` IN ('张三', '李四', '王五', '孙六') \nORDER BY FIELD(`name`, '李四', '孙六', '张三', '王五')\n")])])]),e("h3",{attrs:{id:"_4-查询字段和注释"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-查询字段和注释"}},[a._v("#")]),a._v(" 4.查询字段和注释")]),a._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("  select COLUMN_NAME,column_comment \n  from INFORMATION_SCHEMA.Columns \n  where table_name='表名' and table_schema='数据库'\n  \n")])])]),e("h3",{attrs:{id:"_5-查询表结构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-查询表结构"}},[a._v("#")]),a._v(" 5.查询表结构")]),a._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("\nSELECT a.table_name,b.TABLE_COMMENT,a.COLUMN_NAME,a.COLUMN_TYPE,a.COLUMN_COMMENT \nFROM information_schema.COLUMNS a \nJOIN information_schema.TABLES b ON a.table_schema = b.table_schema AND a.table_name = b.table_name\nWHERE a.table_name = 'question';\n\n")])])]),e("h3",{attrs:{id:"_6-时间转换"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-时间转换"}},[a._v("#")]),a._v(" 6.时间转换")]),a._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("\nUNIX_TIMESTAMP('2017-04-21 08:30:00') - FLOOR(RAND()*100*3600*24);\n\ndate_format();\n\n")])])]),e("h3",{attrs:{id:"_7-根据日期查数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-根据日期查数据"}},[a._v("#")]),a._v(" 7. 根据日期查数据")]),a._v(" "),e("blockquote",[e("p",[a._v("来源地址： https://www.cnblogs.com/inkyi/p/5382868.html")])]),a._v(" "),e("p",[a._v("user_event ：用户事件表")]),a._v(" "),e("p",[a._v("create_time ：表中存储时间的字段")]),a._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("\n#获取当月数据\nSELECT * FROM user_event WHERE DATE_FORMAT(create_time,'%Y-%m') = DATE_FORMAT(NOW(),'%Y-%m');  \n#获取3月份数据\nSELECT * FROM user_event WHERE DATE_FORMAT(create_time,'%Y-%m') = DATE_FORMAT('2016-03-01','%Y-%m');  \n\n#获取三月份数据\nSELECT * FROM user_event WHERE YEAR(create_time)='2016' AND MONTH(create_time)='3';  \n\n#获取本周数据\nSELECT * FROM user_event WHERE YEARWEEK(DATE_FORMAT(create_time,'%Y-%m-%d')) = YEARWEEK(NOW());   \n\n#查询上周的数据 \nSELECT * FROM user_event WHERE YEARWEEK(DATE_FORMAT(create_time,'%Y-%m-%d')) = YEARWEEK(NOW())-1;   \n\n#查询距离当前现在6个月的数据 \nSELECT * FROM user_event WHERE create_time BETWEEN DATE_SUB(NOW(),interval 6 month) and NOW();  \n\n#查询上个月的数据 \nSELECT * FROM user_event WHERE DATE_FORMAT(create_time,'%Y-%m')=DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL 1 MONTH),'%Y-%m');  \n\n\n#查询今天的信息记录：\nSELECT * FROM user_event WHERE TO_DAYS(`create_time`) = TO_DAYS(NOW());  \n\n#查询昨天的信息记录：\nSELECT * FROM user_event WHERE TO_DAYS(now()) - TO_DAYS(create_time) <= 1;  \n\n#查询近7天的信息记录：\nSELECT * FROM user_event WHERE DATE_SUB(curdate(), INTERVAL 7 DAY) <= DATE(create_time);  \n\n#查询近30天的信息记录：\nSELECT * FROM user_event WHERE DATE_SUB(curdate(), INTERVAL 30 DAY) <= DATE(create_time);  \n\n#查询上一月的信息记录：\nSELECT * FROM user_event WHERE PERIOD_DIFF(DATE_FORMAT(NOW(), '%Y%m'), DATE_FORMAT(create_time, '%Y%m')) =1;   \n")])])]),e("h3",{attrs:{id:"_8-导出数据库结构和数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_8-导出数据库结构和数据"}},[a._v("#")]),a._v(" 8. 导出数据库结构和数据")]),a._v(" "),e("div",{staticClass:"language-shell extra-class"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[a._v("$ mysqldump "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-uroot")]),a._v(" "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" dbname "),e("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" dbname .sql\n")])])]),e("h3",{attrs:{id:"_9-查看用户登录-限制ip"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_9-查看用户登录-限制ip"}},[a._v("#")]),a._v(" 9. 查看用户登录，限制ip")]),a._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("SELECT user,host FROM mysql.user;\n")])])]),e("h3",{attrs:{id:"_10-新增用户限制ip"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_10-新增用户限制ip"}},[a._v("#")]),a._v(" 10. 新增用户限制ip")]),a._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("GRANT ALL PRIVILEGES ON *.* TO 'root'@'222.240.125.80'IDENTIFIED BY 'edu2019weft1' WITH GRANT OPTION;\n\nflush privileges;\n")])])]),e("h3",{attrs:{id:"_11-临时修改数据库sql-mode"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_11-临时修改数据库sql-mode"}},[a._v("#")]),a._v(" 11. 临时修改数据库"),e("code",[a._v("sql_mode")])]),a._v(" "),e("div",{staticClass:"language-mysql extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("set global  sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' ;\nset session  sql_mode='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION' ;\n")])])])])}),[],!1,null,null,null);e.default=_.exports}}]);