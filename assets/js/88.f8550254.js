(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{428:function(s,t,a){"use strict";a.r(t);var n=a(25),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"mssql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#mssql"}},[s._v("#")]),s._v(" mssql")]),s._v(" "),t("blockquote",[t("p",[s._v("安装扩展sqlserver（mssql）")])]),s._v(" "),t("h2",{attrs:{id:"运行环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行环境"}},[s._v("#")]),s._v(" 运行环境")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ubutun 18\n\nphp 7.3\n\nyii\n\nsqlserver 2017 （vagrant box:janobono/xenial64-sqlserver2017）\n")])])]),t("h2",{attrs:{id:"安装过程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装过程"}},[s._v("#")]),s._v(" 安装过程")]),s._v(" "),t("ul",[t("li",[s._v("安装扩展报错")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ pecl "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" sqlsrv\n")])])]),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("/tmp/pear/temp/sqlsrv/shared/xplat.h:30:10: fatal error: sql.h: No such file or directory\n #include <sql.h>\n          ^~~~~~~\ncompilation terminated.\nMakefile:194: recipe for target 'conn.lo' failed\nmake: *** [conn.lo] Error 1\nERROR: `make' failed\nroot@vagrant:/data/wwwroot/xc# apt-get install -y msodbcsql mssql-tools unixODBC-devel\nReading package lists... Done\nBuilding dependency tree       \nReading state information... Done\nE: Unable to locate package msodbcsql\nE: Unable to locate package mssql-tools\nE: Unable to locate package unixODBC-devel\n")])])]),t("ul",[t("li",[s._v("解决报错信息")])]),s._v(" "),t("blockquote",[t("p",[s._v("经查询是因为  安装sqlsrv 需要unixODBC的支持，\n所以在安装之前如果你没有安装过unixODBC还需要先安装unixODBC\n执行 安装 unixODBC就可以啦")])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://blog.csdn.net/qq_37126235/article/details/81939882",target:"_blank",rel:"noopener noreferrer"}},[s._v("原文"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("sudo apt-get install unixodbc-dev\n")])])]),t("ul",[t("li",[s._v("继续安装，成功")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ pecl "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" sqlsrv\n$ pecl "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" pdo_sqlsrv\n")])])]),t("ul",[t("li",[s._v("运行demo，报错")])]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-definition function"}},[s._v("actionQuestion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$db")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Connection")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'dsn'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'sqlsrv:Server=192.168.77.71;Database=XCDB'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'username'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'SA'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'password'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'Passw0rd'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'charset'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'utf8'")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//$db->open();")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$command")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$db")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("createCommand")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string single-quoted-string"}},[s._v("'SELECT * FROM tb_live_catalog'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$posts")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$command")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("execute")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("var_dump")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$posts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("exit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])]),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Exception "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'yii\\db\\Exception'")]),s._v(" with message "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SQLSTATE[IMSSP]: This extension requires the Microsoft ODBC Driver for SQL Server to communicate with SQL Server. Access the following URL to download the ODBC Driver for SQL Server for x64: https://go.microsoft.com/fwlink/?LinkId=163712'")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /data/wwwroot/xc/vendor/yiisoft/yii2/db/Connection.php:624\n\nError Info:\nArray\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" IMSSP\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-1")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" This extension requires the Microsoft ODBC Driver "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" SQL Server to communicate with SQL Server. Access the following URL to download the ODBC Driver "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" SQL Server "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" x64: https://go.microsoft.com/fwlink/?LinkId"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("163712")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])])]),t("ul",[t("li",[s._v("解决办法，安装 "),t("code",[s._v("Microsoft ODBC Driver")])])]),s._v(" "),t("p",[t("a",{attrs:{href:"https://docs.microsoft.com/zh-cn/sql/connect/odbc/download-odbc-driver-for-sql-server?view=sql-server-2017",target:"_blank",rel:"noopener noreferrer"}},[s._v("下载地址"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /usr/local/src\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://packages.microsoft.com/ubuntu/18.04/prod/pool/main/m/msodbcsql17/msodbcsql17_17.4.1.1-1_amd64.deb\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v("  dpkg  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-i")]),s._v(" msodbcsql17_17.4.1.1-1_amd64.deb\n")])])]),t("ul",[t("li",[s._v("运行demo,输出")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("root@vagrant:/data/wwwroot/xc"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# php yii batch/question")]),s._v("\nint"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("-1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);